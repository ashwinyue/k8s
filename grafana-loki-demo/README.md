# Grafana Loki æ—¥å¿—é‡‡é›†ä½“ç³»

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Grafana Loki æ—¥å¿—é‡‡é›†å’Œå¯è§†åŒ–ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Go Demo App   â”‚â”€â”€â”€â–¶â”‚    Promtail     â”‚â”€â”€â”€â–¶â”‚      Loki       â”‚
â”‚   (æ—¥å¿—ç”Ÿæˆ)     â”‚    â”‚   (æ—¥å¿—é‡‡é›†)     â”‚    â”‚   (æ—¥å¿—å­˜å‚¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚    Grafana      â”‚
                                               â”‚   (æ—¥å¿—å¯è§†åŒ–)   â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ç»„ä»¶è¯´æ˜

### 1. Loki
- **ä½œç”¨**: æ—¥å¿—èšåˆç³»ç»Ÿï¼Œç±»ä¼¼ Prometheus ä½†ä¸“é—¨ç”¨äºæ—¥å¿—
- **ç‰¹ç‚¹**: ä¸ç´¢å¼•æ—¥å¿—å†…å®¹ï¼Œåªç´¢å¼•æ ‡ç­¾ï¼Œå­˜å‚¨æˆæœ¬ä½
- **ç«¯å£**: 3100

### 2. Grafana
- **ä½œç”¨**: æ•°æ®å¯è§†åŒ–å¹³å°ï¼Œæä¾›æ—¥å¿—æŸ¥è¯¢å’Œä»ªè¡¨æ¿
- **ç‰¹ç‚¹**: æ”¯æŒå¤šç§æ•°æ®æºï¼Œå¼ºå¤§çš„æŸ¥è¯¢å’Œå¯è§†åŒ–èƒ½åŠ›
- **ç«¯å£**: 3000
- **é»˜è®¤è´¦å·**: admin/admin

### 3. Promtail
- **ä½œç”¨**: æ—¥å¿—é‡‡é›†ä»£ç†ï¼Œè´Ÿè´£æ”¶é›†å’Œè½¬å‘æ—¥å¿—åˆ° Loki
- **ç‰¹ç‚¹**: è½»é‡çº§ï¼Œæ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼å’Œæ¥æº
- **ç«¯å£**: 9080

### 4. Go Demo App
- **ä½œç”¨**: æ¼”ç¤ºåº”ç”¨ï¼Œç”Ÿæˆå„ç§ç±»å‹çš„æ—¥å¿—
- **ç‰¹ç‚¹**: åŒ…å«ç»“æ„åŒ–æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€è®¿é—®æ—¥å¿—ç­‰
- **ç«¯å£**: 8080

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### 2. è®¿é—®æœåŠ¡
- **Grafana**: http://localhost:3000 (admin/admin)
- **Loki**: http://localhost:3100
- **Go Demo App**: http://localhost:8080
- **Promtail**: http://localhost:9080

### 3. é…ç½® Grafana
1. ç™»å½• Grafana
2. æ·»åŠ  Loki æ•°æ®æº: http://loki:3100
3. å¯¼å…¥é¢„é…ç½®çš„ä»ªè¡¨æ¿
4. å¼€å§‹æŸ¥è¯¢æ—¥å¿—

## ğŸ“ ç›®å½•ç»“æ„

```
grafana-loki-demo/
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ docker-compose.yml        # Docker ç¼–æ’æ–‡ä»¶
â”œâ”€â”€ configs/                  # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ loki.yml             # Loki é…ç½®
â”‚   â”œâ”€â”€ promtail.yml         # Promtail é…ç½®
â”‚   â””â”€â”€ grafana/             # Grafana é…ç½®
â”‚       â”œâ”€â”€ datasources/     # æ•°æ®æºé…ç½®
â”‚       â””â”€â”€ dashboards/      # ä»ªè¡¨æ¿é…ç½®
â”œâ”€â”€ go-demo/                 # Go æ¼”ç¤ºåº”ç”¨
â”‚   â”œâ”€â”€ main.go             # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ go.mod              # Go æ¨¡å—æ–‡ä»¶
â”‚   â”œâ”€â”€ Dockerfile          # Docker é•œåƒ
â”‚   â””â”€â”€ logs/               # æ—¥å¿—è¾“å‡ºç›®å½•
â””â”€â”€ data/                   # æ•°æ®æŒä¹…åŒ–ç›®å½•
    â”œâ”€â”€ loki/               # Loki æ•°æ®
    â””â”€â”€ grafana/            # Grafana æ•°æ®
```

## ğŸ” æ—¥å¿—æŸ¥è¯¢ç¤ºä¾‹

### LogQL æŸ¥è¯¢è¯­æ³•
```logql
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
{job="go-demo"}

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
{job="go-demo"} |= "ERROR"

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´èŒƒå›´çš„æ—¥å¿—
{job="go-demo"}[5m]

# ç»Ÿè®¡é”™è¯¯æ—¥å¿—æ•°é‡
sum(count_over_time({job="go-demo"} |= "ERROR"[5m]))

# æŒ‰çº§åˆ«åˆ†ç»„ç»Ÿè®¡
sum by (level) (count_over_time({job="go-demo"}[5m]))
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æ—¥å¿—æº
1. ä¿®æ”¹ `promtail.yml` æ·»åŠ æ–°çš„ scrape_configs
2. é‡å¯ Promtail æœåŠ¡
3. åœ¨ Grafana ä¸­åˆ›å»ºæ–°çš„æŸ¥è¯¢

### è‡ªå®šä¹‰ä»ªè¡¨æ¿
1. åœ¨ Grafana ä¸­åˆ›å»ºæ–°ä»ªè¡¨æ¿
2. å¯¼å‡º JSON é…ç½®
3. ä¿å­˜åˆ° `configs/grafana/dashboards/`

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

- æ—¥å¿—æ‘„å…¥é€Ÿç‡
- é”™è¯¯æ—¥å¿—æ¯”ä¾‹
- æœåŠ¡å“åº”æ—¶é—´
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜
1. **Loki æ— æ³•å¯åŠ¨**: æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•å’Œç«¯å£å ç”¨
2. **Promtail æ— æ³•é‡‡é›†**: æ£€æŸ¥æ—¥å¿—æ–‡ä»¶è·¯å¾„å’Œæƒé™
3. **Grafana æ— æ³•è¿æ¥ Loki**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œæ•°æ®æºé…ç½®

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs loki
docker-compose logs promtail
docker-compose logs grafana
docker-compose logs go-demo
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [Loki å®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/loki/)
- [Grafana å®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/grafana/)
- [Promtail é…ç½®æŒ‡å—](https://grafana.com/docs/loki/latest/clients/promtail/)
- [LogQL æŸ¥è¯¢è¯­è¨€](https://grafana.com/docs/loki/latest/logql/)